#!/bin/bash

HTPASSWD=$(aws ssm get-parameters --name nginx-auth --region us-east-1 --with-decryption --output text --query Parameters[].Value)
ENCODED=$(echo $HTPASSWD | base64)
sed -i "s/nginx.basic-auth:.*/nginx.basic-auth: \"$HTPASSWD\"/" ~/dev*/K8S/manifests/nginx-app-deploy/config-map.yaml
sed -i "s/value: Basic.*/value: Basic $ENCODED/" ~/dev*/K8S/manifests/nginx-app-deploy/deployment.yaml